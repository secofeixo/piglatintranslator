<!-- views/signup.ejs -->
<!doctype html>
<html>
<head>
	<title>Signup</title>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css"> <!-- load bootstrap css -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"> <!-- load fontawesome -->
	<style>
		body 		{ padding-top:80px; }
	</style>
</head>
<body>
<div ng-app="signupApp" ng-controller="ctrlSignup as ctrl">
	<div class="container">

	<div class="col-sm-6 col-sm-offset-3">

		<h1><span class="fa fa-sign-in"></span> Signup</h1>

		<!-- show any messages that come back with authentication -->
			<div class="alert alert-danger" ng-show="message !== undefined">{{ message }}</div>

		<!-- LOGIN FORM -->
		<form>
			<div class="form-group">
				<label>Email</label>
				<input type="text" class="form-control" name="email" ng-model="email">
			</div>
			<div class="form-group">
				<label>Password</label>
				<input type="password" class="form-control" name="password" ng-model="password">
			</div>

      <md-button ng-click="signupBtn()" class="btn btn-warning btn-lg">
        Signup
      </md-button>
		</form>

		<hr>

		<p>Already have an account? <a href="/login">Login</a></p>
		<p>Or go <a href="/">home</a>.</p>

	</div>
	</div>

</div>
</body>
<script>
var app = angular.module('signupApp', []);


app.controller('ctrlSignup', function($scope, $http, $window) {
		$scope.message = undefined;
		url = "http://localhost:8080/";
    $scope.signupBtn = function () {
    	console.log('login. email:' + $scope.email + ". pwd: " + $scope.password );
    	if (($scope.email !== undefined)&& ($scope.password!== undefined)){
    		$scope.message = undefined;
        var sQuerySignup = url+"api/signup";
        $http.post(sQuerySignup, {email:$scope.email, password:$scope.password}).
					then(response => {
						// this callback will be called asynchronously
						// when the response is available
						console.log("Signup SUCCESS!!! ");
						$window.location.href=url+'verifyemail';
					}, responseError =>{
						// called asynchronously if an error occurs
						// or server returns response with an error status.
						$scope.message = `Signup error. ${JSON.stringify(responseError.data.msg)}`;
					});
    	} else {
    		$scope.message = 'Write email and password in order to sign up.';
    	}
    }
});
</script>
</html>
